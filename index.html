<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Birthday Countdown</title>
  <style>
    :root {
      --bg:#f9fafb;
      --card:#ffffff;
      --accent:#2563eb;
      --accent-light:#60a5fa;
      --muted:#64748b;
      --border:#e5e7eb;
      --shadow: rgba(0,0,0,0.06);
      --text:#111827;
    }
    body.dark {
      --bg:#111827;
      --card:#1f2937;
      --accent:#60a5fa;
      --accent-light:#93c5fd;
      --muted:#9ca3af;
      --border:#374151;
      --shadow: rgba(0,0,0,0.6);
      --text:#f9fafb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg);
      color:var(--text);
      padding:24px;
      transition: background 0.3s, color 0.3s;
    }
    .widget {
      width:100%;
      max-width:520px;
      background:var(--card);
      border-radius:12px;
      box-shadow: 0 6px 20px var(--shadow);
      border:1px solid var(--border);
      padding:18px;
      transition: background 0.3s, border 0.3s;
      position:relative;
    }
    .header {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .logo {
      width:48px;
      height:48px;
      background:linear-gradient(135deg,var(--accent), var(--accent-light));
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      line-height:1;
    }
    .title { font-size:18px; font-weight:600; line-height:1; }
    .subtitle { color:var(--muted); font-size:13px; margin-top:2px; }
    .controls {
      display:flex;
      gap:8px;
      margin:12px 0 18px 0;
      align-items:center;
      flex-wrap:wrap;
    }
    input[type="date"]{
      padding:10px 12px;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--card);
      color:var(--text);
      font-size:14px;
      outline:none;
      flex:1;
      min-width:160px;
    }
    button {
      padding:10px 14px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:600;
      background:linear-gradient(90deg,var(--accent), var(--accent-light));
      color:#fff;
      box-shadow: 0 4px 12px rgba(37,99,235,0.2);
    }
    .countdown {
      display:grid;
      grid-template-columns: repeat(5,1fr);
      gap:12px;
      margin-top:8px;
    }
    .tile {
      background:#f8fafc;
      padding:12px;
      text-align:center;
      border-radius:8px;
      border:1px solid var(--border);
      transition: background 0.3s;
    }
    body.dark .tile{background:#111827;}
    .num { font-size:24px; font-weight:700; color:var(--accent); }
    .lbl { font-size:12px; color:var(--muted); margin-top:6px; text-transform:uppercase; letter-spacing:0.06em; }
    .footer {
      margin-top:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      font-size:13px;
      flex-wrap:wrap;
      gap:8px;
    }
    .small { font-size:12px; color:var(--muted); }
    .toggle-btn { font-size:16px; background:none; border:none; cursor:pointer; color:var(--text); }
    @media (max-width:480px){
      .header {flex-direction:column;align-items:flex-start;gap:8px;}
      .controls {flex-direction:column;width:100%;}
      .controls input[type="date"], .controls button {width:100%;}
      .countdown {grid-template-columns: repeat(2,1fr);}
    }
    @media (max-width:340px){
      .countdown {grid-template-columns:1fr;}
    }
    canvas#confetti {
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="widget" id="birthday-widget" aria-live="polite">
    <canvas id="confetti"></canvas>
    <div class="header">
      <div style="display:flex; gap:12px; align-items:center;">
        <div class="logo" aria-hidden="true">üéÇ</div>
        <div>
          <div class="title">Birthday Countdown</div>
          <div class="subtitle">See how many days until the next birthday</div>
        </div>
      </div>
      <button class="toggle-btn" id="dark-toggle" aria-label="Toggle dark mode">üåô</button>
    </div>
    <div class="controls" role="region" aria-label="Birthday controls">
      <input id="date-input" type="date" aria-label="Birthday date" />
      <button id="set-btn">Set</button>
      <button id="share-btn">Share</button>
    </div>
    <div id="countdown" class="countdown" aria-hidden="false">
      <div class="tile"><div class="num" id="years">--</div><div class="lbl">Years</div></div>
      <div class="tile"><div class="num" id="months">--</div><div class="lbl">Months</div></div>
      <div class="tile"><div class="num" id="days">--</div><div class="lbl">Days</div></div>
      <div class="tile"><div class="num" id="hours">--</div><div class="lbl">Hours</div></div>
      <div class="tile"><div class="num" id="minutes">--</div><div class="lbl">Minutes</div></div>
      <div class="tile"><div class="num" id="seconds">--</div><div class="lbl">Seconds</div></div>
    </div>
    <div class="footer">
      <div class="small" id="message">Pick your birthday above.</div>
      <div class="small">Made by you ‚Ä¢ <time id="now-year"></time></div>
    </div>
  </div>

  <script>
    const DATE_KEY="birthday-widget-date";
    const THEME_KEY="birthday-widget-theme";
    const dateInput=document.getElementById("date-input");
    const setBtn=document.getElementById("set-btn");
    const shareBtn=document.getElementById("share-btn");
    const nowYearEl=document.getElementById("now-year");
    const darkToggle=document.getElementById("dark-toggle");
    const messageEl=document.getElementById("message");
    nowYearEl.textContent=new Date().getFullYear();
    let target=null, birthDate=null, confettiPlayed=false;

    // Dark Mode
    if(localStorage.getItem(THEME_KEY)==="dark"){document.body.classList.add("dark");darkToggle.textContent="‚òÄÔ∏è";}
    darkToggle.addEventListener("click",()=>{
      document.body.classList.toggle("dark");
      const dark=document.body.classList.contains("dark");
      localStorage.setItem(THEME_KEY,dark?"dark":"light");
      darkToggle.textContent=dark?"‚òÄÔ∏è":"üåô";
    });

    // Birthday logic
    function nextBirthdayFromInput(val){
      if(!val) return null;
      const [y,m,d] = val.split('-').map(Number);
      birthDate=new Date(y,m-1,d);
      const now=new Date();
      let candidate=new Date(now.getFullYear(),m-1,d,0,0,0,0);
      if(candidate<now){candidate=new Date(now.getFullYear()+1,m-1,d,0,0,0,0);}
      return candidate;
    }
    function calcAge(birth, now){
      let years=now.getFullYear()-birth.getFullYear();
      let months=now.getMonth()-birth.getMonth();
      let days=now.getDate()-birth.getDate();
      if(days<0){months--;const prev=new Date(now.getFullYear(),now.getMonth(),0);days+=prev.getDate();}
      if(months<0){years--;months+=12;}
      return {years,months,days};
    }

    function updateUI(target){
      if(!target){
        ["years","months","days","hours","minutes","seconds"].forEach(id=>document.getElementById(id).textContent="--");
        messageEl.textContent="Pick your birthday above.";
        return;
      }
      const now=new Date();
      const diff=target-now;
      if(diff<=0){
        messageEl.textContent="Happy Birthday! üéâ";
        ["years","months","days","hours","minutes","seconds"].forEach(id=>document.getElementById(id).textContent="0");
        if(!confettiPlayed){playConfetti();confettiPlayed=true;}
        return;
      }
      const days=Math.floor(diff/(1000*60*60*24));
      const hours=Math.floor((diff/(1000*60*60))%24);
      const minutes=Math.floor((diff/(1000*60))%60);
      const seconds=Math.floor((diff/1000)%60);
      const age=birthDate?calcAge(birthDate,now):{years:"--",months:"--",days:"--"};
      document.getElementById("years").textContent=age.years;
      document.getElementById("months").textContent=age.months;
      document.getElementById("days").textContent=days;
      document.getElementById("hours").textContent=hours;
      document.getElementById("minutes").textContent=minutes;
      document.getElementById("seconds").textContent=seconds;
      const opts={month:"short",day:"numeric"};
      messageEl.textContent="Next birthday on "+target.toLocaleDateString(undefined,opts)+".";
    }

    // Confetti
    function playConfetti(){
      const canvas=document.getElementById("confetti");
      const ctx=canvas.getContext("2d");
      canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;
      let particles=[];
      for(let i=0;i<150;i++){
        particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,
          r:Math.random()*6+4,dx:Math.random()*4-2,dy:Math.random()*4-2,color:`hsl(${Math.random()*360},100%,50%)`});
      }
      function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        particles.forEach(p=>{
          ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=p.color;ctx.fill();
        });
      }
      function update(){
        particles.forEach(p=>{
          p.x+=p.dx;p.y+=p.dy;p.dy+=0.05;
          if(p.y>canvas.height) p.y=0;
          if(p.x>canvas.width) p.x=0;
          if(p.x<0) p.x=canvas.width;
        });
      }
      let frames=0;
      function loop(){
        draw();update();frames++;
        if(frames<200){requestAnimationFrame(loop);}else{ctx.clearRect(0,0,canvas.width,canvas.height);}
      }
      loop();
    }

    // Notifications
    if("Notification" in window && Notification.permission!=="granted"){Notification.requestPermission();}
    function notifyBirthday(){
      if(Notification.permission==="granted"){new Notification("üéâ Happy Birthday!",{body:"Your countdown reached 0!"});}
    }

    // Share Button
    shareBtn.addEventListener("click",()=>{
      if(!dateInput.value)return;
      const url=new URL(window.location.href);
      url.searchParams.set("birthday",dateInput.value);
      navigator.clipboard.writeText(url.toString());
      alert("Sharable link copied to clipboard!");
    });

    // Setup
    let saved=localStorage.getItem(DATE_KEY);
    const urlParams=new URLSearchParams(window.location.search);
    if(urlParams.get("birthday")) saved=urlParams.get("birthday");
    if(saved) dateInput.value=saved;
    target=saved?nextBirthdayFromInput(saved):null;
    if(target) updateUI(target);

    setBtn.addEventListener("click",()=>{
      const v=dateInput.value;
      if(!v){localStorage.removeItem(DATE_KEY);target=null;updateUI(null);return;}
      localStorage.setItem(DATE_KEY,v);
      target=nextBirthdayFromInput(v);
      confettiPlayed=false;
      updateUI(target);
    });

    setInterval(()=>{if(target){updateUI(target);}},1000);
  </script>
</body>
</html>
